>官方文档 https://istio.io/latest/zh/docs/overview/what-is-istio/
## Istio 能力
- **服务发现**：Istio 依赖于底层的服务发现机制，如 Kubernetes 的服务注册表，来获取服务的地址和端口等信息。它通过与这些底层系统集成，能够自动感知服务的添加、删除和更新，从而为流量管理提供基础。
- **流量管理**：Istio 使用 Envoy 代理来控制服务之间的流量。Envoy 代理会拦截进出服务的所有流量，并根据 Istio 配置的规则进行流量路由、负载均衡等操作。例如，可以根据服务的版本、权重等因素，将请求路由到不同的服务实例上。
- **安全通信**：Istio 通过 TLS 加密来确保服务之间的通信安全。它为每个服务生成和管理证书，实现服务之间的双向身份验证，防止数据在传输过程中被窃取或篡改。同时，Istio 还支持基于身份的访问控制，只有经过授权的服务或用户才能访问特定的资源。
- **遥测与监控**：Istio 收集服务之间的流量数据，如请求数量、响应时间、错误率等指标，并将这些数据发送到监控和日志系统。通过对这些数据的分析，运维人员可以了解系统的运行状态，及时发现和解决问题。

## 案例
以下以一个简单的微服务架构，包含客户端（Client）、服务A（Service A）和服务B（Service B）为例，通过序列图来说明 Istio 的请求流程： 
1. **初始化环境** 
- Istio 控制平面（Control Plane）部署并管理着各个微服务的配置，包括服务发现、流量规则等。 
- 数据平面（Data Plane）由每个微服务旁边的 Envoy 代理组成，负责实际的流量处理。 
2. **序列图描述**
![[Pasted image 20250213234849.png]]
### 流程说明 
4. **客户端发起请求**：客户端向服务 A 发起请求。 
5. **服务 A 的 Envoy 代理接收请求**：请求首先到达服务 A 对应的 Envoy 代理。Envoy 代理向 Istio 控制平面查询服务发现信息和相关流量规则。 
6. **选择服务 A 实例**：Envoy 代理根据从控制平面获取的信息，依据负载均衡策略从服务 A 的实例列表中选择一个实例，并将请求转发给它。
7. **服务 A 处理请求**：服务 A 接收到请求并进行处理。如果服务 A 在处理过程中需要调用服务 B ： 
- **服务 A 内部请求处理**：服务 A 向其 Envoy 代理发起调用服务 B 的请求。 
- **查询服务 B 信息**：服务 A 的 Envoy 代理再次向 Istio 控制平面查询服务 B 的服务发现和流量规则。 
- **选择服务 B 实例**：根据获取的信息，选择一个服务 B 的实例，并将请求转发给服务 B 的 Envoy 代理。 
- **服务 B 的 Envoy 代理接收请求**：服务 B 的 Envoy 代理接收到请求后，向 Istio 控制平面查询服务 B 的相关配置，如安全策略等。 
- **安全检查与转发**：服务 B 的 Envoy 代理进行安全检查，确认无误后将请求转发给服务 B。 
- **服务 B 处理请求**：服务 B 处理请求并将响应返回给其 Envoy 代理。 
- **响应传递**：服务 B 的 Envoy 代理将响应传递给服务 A 的 Envoy 代理。 
8. **返回响应**：服务 A 的 Envoy 代理将最终响应返回给客户端。如果服务 A 无需调用其他服务，则直接由服务 A 将响应返回给其 Envoy 代理，再由 Envoy 代理返回给客户端。